<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="content-type" content="text/html;charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="./main.css">
        <script id="vertex" type="x-shader/x-vertex">
attribute vec3 aVertexPosition;
void main() {
    gl_Position = vec4(aVertexPosition.xy, 0.0, 1.0);
}
        </script>
        <script id="fragment" type="x-shader/x-fragment">
precision mediump float;
uniform vec4 uScreenSize;
uniform float uTime;

float sphere(vec3 p, float r, vec3 ro, vec3 rd) {
    vec3 oc = ro - p;
    float a = dot(rd, rd);
    float b = 2. * dot(oc, rd);
    float c = dot(oc, oc) - r * r;
    
    float d = b * b - 4. * a * c;
    if (d < 0.) {
        return -1.;
    }
    else {
        return (-b - sqrt(d)) / (2. * a);
    }
}

vec3 rayDirection(float fov, vec2 size, vec2 fragCoord) {
    vec2 xy = fragCoord - size / 2.0;
    float z = size.y / tan(radians(fov) / 2.0);

    return normalize(vec3(xy, -z));
}

vec4 color(vec3 ro, vec3 rd, vec3 so) {
    float t = sphere(so, 1., ro, rd);
    if (t > 0.) {
        vec3 hp = ro + rd * t;
        vec3 n = (normalize(hp - so) + 1.) * .5;
        return vec4(n, 1.);
    }
    return vec4(.1, .1, .1, 1.);
}

void main() {
    vec3 eye = vec3(0, 0, 5);
    vec3 rd = rayDirection(45., uScreenSize.xy, gl_FragCoord.xy);

    gl_FragColor = color(eye, rd, vec3(0, 0, 0));
}
        </script>
    </head>
    <body>
        <canvas id="canvas" height="500"></canvas>
        <script type="text/javascript" src="./main.js"></script>
    </body>
</html>